<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mock Debate Chatbot</title>
  <style>
    body { margin:0; font-family:sans-serif; background:#0b1526; color:#e6eef6; }
    .container { display:flex; gap:20px; padding:20px; }
    .left, .right { flex:1; background:#101c33; padding:16px; border-radius:12px; }
    h2 { margin-top:0; }
    textarea { width:100%; min-height:50px; }
    button { margin-top:6px; padding:6px 12px; border:none; border-radius:6px; cursor:pointer; }
    .claim { margin:6px 0; padding:6px; border-radius:6px; }
    .valid { background:rgba(0,200,0,0.2); }
    .invalid { background:rgba(200,0,0,0.2); }
    .unsure { background:rgba(200,200,0,0.2); }
  </style>
</head>
<body>
  <div class="container">
    <div class="left">
      <h2>Debate Setup</h2>
      <label>Debate Topic:</label>
      <input id="topic" type="text" placeholder="Enter topic (e.g., Vote Scam)" style="width:100%;margin-bottom:10px;" />

      <label>Team A (For):</label>
      <input id="teamAName" type="text" placeholder="e.g., Rahul Gandhi / Congress" style="width:100%;margin-bottom:10px;" />

      <label>Team B (Against):</label>
      <input id="teamBName" type="text" placeholder="e.g., Narendra Modi / BJP" style="width:100%;margin-bottom:10px;" />

      <h2>Add Claim</h2>
      <select id="teamSelect">
        <option value="A">Team A</option>
        <option value="B">Team B</option>
      </select>
      <input id="speaker" type="text" placeholder="Speaker name" />
      <textarea id="claimInput" placeholder="Enter claim..."></textarea>
      <button id="addClaim">Add Claim</button>

      <h2>Claims Board</h2>
      <div id="claimsBoard"></div>
      <button id="clearClaims" style="background:#c33;color:#fff;">Clear Claims</button>
    </div>

    <div class="right">
      <h2>Vote Counter</h2>
      <div id="scoreboard">
        <p><span id="teamA_label">Team A</span>: <span id="scoreA">0</span></p>
        <p><span id="teamB_label">Team B</span>: <span id="scoreB">0</span></p>
      </div>
      <button onclick="vote('A')">Vote Team A</button>
      <button onclick="vote('B')">Vote Team B</button>
      <button onclick="resetVotes()">Reset</button>
    </div>
  </div>

  <script>
    const API_BASE = "https://sstdebateaps.onrender.com"; // your Render backend
    let claims = [];
    let scoreA = 0, scoreB = 0;

    // Update team labels when inputs change
    document.getElementById("teamAName").addEventListener("input", () => {
      document.getElementById("teamA_label").innerText = document.getElementById("teamAName").value || "Team A";
    });
    document.getElementById("teamBName").addEventListener("input", () => {
      document.getElementById("teamB_label").innerText = document.getElementById("teamBName").value || "Team B";
    });

    function renderClaims() {
      const board = document.getElementById("claimsBoard");
      board.innerHTML = "";
      claims.forEach((c, i) => {
        const div = document.createElement("div");
        div.className = "claim " + c.status;
        div.innerHTML = `<b>${c.teamName} â€” ${c.speaker}</b><br>${c.text}<br>Status: ${c.status}`;
        board.appendChild(div);
      });
    }

    document.getElementById("addClaim").onclick = () => {
      const text = document.getElementById("claimInput").value.trim();
      const speaker = document.getElementById("speaker").value.trim() || "anon";
      const teamVal = document.getElementById("teamSelect").value;
      const teamName = teamVal === "A" ? document.getElementById("teamAName").value || "Team A"
                                       : document.getElementById("teamBName").value || "Team B";
      if (!text) return;

      const claim = { text, speaker, team: teamVal, teamName, status: "verifying" };
      claims.push(claim);
      renderClaims();
      verifyClaim(claim, claims.length - 1);
      document.getElementById("claimInput").value = "";
    };

    async function verifyClaim(claim, index) {
      try {
        const resp = await fetch(`${API_BASE}/api/ai-verify`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            claim: claim.text,
            team: claim.team,
            topic: document.getElementById("topic").value || "General Debate"
          })
        });
        const data = await resp.json();
        claims[index].status = data.verdict || "unsure";
      } catch (e) {
        claims[index].status = "unsure";
      }
      renderClaims();
    }

    document.getElementById("clearClaims").onclick = () => {
      claims = [];
      renderClaims();
    };

    function vote(team) {
      if (team === "A") scoreA++;
      else scoreB++;
      document.getElementById("scoreA").innerText = scoreA;
      document.getElementById("scoreB").innerText = scoreB;
    }
    function resetVotes() {
      scoreA = 0; scoreB = 0;
      document.getElementById("scoreA").innerText = scoreA;
      document.getElementById("scoreB").innerText = scoreB;
    }
  </script>
</body>
</html>
